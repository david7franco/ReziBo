{% extends 'base.html' %}
{% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>Chatroom</title>
</head>
<body>
    {% block content %}
        {% if task %}
            <div id="chat-box">
                <script>fetchMessages();</script>
                <p>Loaded Messages</p>
                <!-- Chat messages will be loaded here -->
            </div>

            <form id="message-form" method="post" action="{% url 'chat_message_send' task.id %}">
                {% csrf_token %}
                <input type="text" name="message" required placeholder="Type a message...">
                <button type="submit">Send</button>
            </form>
        {% else %}
            <p>Task not found.</p>
        {% endif %}
    {% endblock %}

    <script>
        function fetchMessages() {
            fetch('{% url "chat_message_fetch" task.id %}')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('chat-box').innerHTML = html;
                })
                .catch(error => console.error('Error fetching messages:', error));
        }
    
        // Fetch messages when the page loads and periodically
        fetchMessages();
        setInterval(fetchMessages, 5000);
    </script>
</body>
</html>
